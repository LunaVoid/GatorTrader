import os
import psycopg2
from auth import passwordHashedSalted
import base64
os.environ['pguser'] = 'sammy'
os.environ['pgpassword'] = 'password'


conn = psycopg2.connect(
        host="localhost",
        database="gatortrader",
        user= os.environ['pguser'],
        password=os.environ['pgpassword'])


cur = conn.cursor();
cur.execute('DROP TABLE IF EXISTS users;')
#optimize later to not recreate every time 
cur.execute('''CREATE TABLE IF NOT EXISTS users (
    userid SERIAL PRIMARY KEY,
    profile_pic BYTEA,
    username VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    email_token VARCHAR(255),
    email_verified BOOLEAN DEFAULT FALSE,
    token_expires TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    mimetype VARCHAR(255)
    );'''
)
# Insert data into the table
imageByte = "data:image/webp;base64,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"
password = "password1"
password = passwordHashedSalted(password)
cur.execute('INSERT INTO users (username, password, profile_pic, email, mimetype)'
            'VALUES (%s, %s, %s, %s, %s)',
            ('hiral',
             password,
             imageByte,
             'hiralshukla@ufl.edu', 'image/webp')
            )
# Execute SELECT query
cur.execute("SELECT * FROM users")

# Fetch all rows from the query result
rows = cur.fetchall()

# Print each row
for row in rows:
    print(row)

cur.execute('SELECT profile_pic FROM users WHERE username = %s', ('hiral',))
retrieved_bytes = cur.fetchone()[0]
base64_string = base64.b64encode(retrieved_bytes).decode('utf-8') 
print(base64_string)


conn.commit()

print(imageByte.split(',')[1] ==  retrieved_bytes)

cur.close()
conn.close()